var builtinComponents=[{name:"Effect List",code:4294967294,group:"",func:"effectList"},{name:"Simple",code:0,group:"Render",func:"simple"},{name:"Dot Plane",code:1,group:"Render",func:"generic",fields:{rotationSpeed:"Int32",colorTop:"Color",colorHigh:"Color",colorMid:"Color",colorLow:"Color",colorBottom:"Color",angle:"Int32",null0:sizeInt}},{name:"Oscilliscope Star",code:2,group:"Render",func:"generic",fields:{audioChannel:["Bit",[2,3],"AudioChannel"],positionX:["Bit",[4,5],"PositionX"],null0:sizeInt-1,colors:"ColorList",size:sizeInt,rotation:sizeInt}},{name:"FadeOut",code:3,group:"Trans",func:"generic",fields:{speed:sizeInt,color:["Color",sizeInt]}},{name:"Blitter Feedback",code:4,group:"Misc",func:"generic",fields:{zoom:sizeInt,onBeatZoom:sizeInt,output:["Map4",{0:"Replace",1:"50/50"}],onBeat:["Bool",sizeInt],bilinear:["Bool",sizeInt]}},{name:"OnBeat Clear",code:5,group:"Render",func:"generic",fields:{color:"Color",output:["Map4",{0:"Replace",1:"50/50"}],clearBeats:sizeInt}},{name:"Blur",code:6,group:"Trans",func:"generic",fields:{blur:["Map4",{0:"None",1:"Medium",2:"Light",3:"Heavy"}],round:["Map4",{0:"Down",1:"Up"}]}},{name:"Bass Spin",code:7,group:"Trans",func:"generic",fields:{enabledLeft:["Bit",0,"Boolified"],enabledRight:["Bit",1,"Boolified"],null0:sizeInt-1,colorLeft:"Color",colorRight:"Color",mode:["Map4",{0:"Lines",1:"Triangles"}]}},{name:"Moving Particle",code:8,group:"Render",func:"generic",fields:{enabled:["Bit",0,"Boolified"],onBeatSizeChange:["Bit",1,"Boolified"],null0:sizeInt-1,color:"Color",range:sizeInt,size:sizeInt,onBeatSize:sizeInt,output:["Map4",{0:"Replace",1:"Additive",2:"50/50",3:"Default"}]}},{name:"Roto Blitter",code:9,group:"Trans",func:"generic",fields:{zoom:sizeInt,rotate:sizeInt,output:["map4",{0:"Replace",1:"50/50"}],onBeatReverse:["boolean",sizeInt],reversalSpeed:sizeInt,onBeatZoom:sizeInt,onBeat:["boolean",sizeInt],bilinear:["boolean",sizeInt]}},{name:"SVP",code:10,group:"Render",func:"generic",fields:{library:["SizeString",260]}},{name:"Colorfade",code:11,group:"Trans",func:"generic",fields:{enabled:["Bit",0,"Boolified"],onBeat:["Bit",2,"Boolified"],onBeatRandom:["Bit",1,"Boolified"],null0:sizeInt-1,fader1:"Int32",fader2:"Int32",fader3:"Int32",beatFader1:"Int32",beatFader2:"Int32",beatFader3:"Int32"}},{name:"Color Clip",code:12,group:"Trans",func:"generic",fields:{mode:["Map4",{0:"Off",1:"Below",2:"Above",3:"Near"}],colorFrom:"Color",colorTo:"Color",colorDistance:sizeInt}},{name:"Rotating Stars",code:13,group:"Render",func:"generic",fields:{colors:"ColorList"}},{name:"Ring",code:14,group:"Render",func:"generic",fields:{audioChannel:["Bit",[2,3],"AudioChannel"],positionX:["Bit",[4,5],"PositionX"],null0:sizeInt-1,colors:"ColorList",size:sizeInt,audioSource:["UInt32",sizeInt,"AudioSource"]}},{name:"Movement",code:15,group:"Trans",func:"movement"},{name:"Scatter",code:16,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt]}},{name:"Dot Grid",code:17,group:"Render",func:"generic",fields:{colors:"ColorList",spacing:sizeInt,speedX:"Int32",speedY:"Int32",output:["Map4",{0:"Replace",1:"Additive",2:"50/50",3:"Default"}]}},{name:"Buffer Save",code:18,group:"Misc",func:"generic",fields:{mode:["BufferMode",sizeInt],buffer:["BufferNum",sizeInt],blend:["BlendmodeBuffer",sizeInt],adjustBlend:sizeInt}},{name:"Dot Fountain",code:19,group:"Render",func:"generic",fields:{rotationSpeed:"Int32",colorTop:"Color",colorHigh:"Color",colorMid:"Color",colorLow:"Color",colorBottom:"Color",angle:"Int32",null0:sizeInt}},{name:"Water",code:20,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt]}},{name:"Comment",code:21,group:"Misc",func:"generic",fields:{text:"SizeString"}},{name:"Brightness",code:22,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],red:"Int32",green:"Int32",blue:"Int32",separate:["Bool",sizeInt],excludeColor:"Color",exclude:["Bool",sizeInt],distance:sizeInt}},{name:"Interleave",code:23,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],x:sizeInt,y:sizeInt,color:"Color",output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],onbeat:["Bool",sizeInt],x2:sizeInt,y2:sizeInt,beatDuration:sizeInt}},{name:"Grain",code:24,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],amount:sizeInt,"static":["Bool",sizeInt]}},{name:"Clear Screen",code:25,group:"Render",func:"generic",fields:{enabled:["Bool",sizeInt],color:["Color",sizeInt],output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50",2:"Default"}],onlyFirst:["Bool",sizeInt]}},{name:"Mirror",code:26,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],topToBottom:["Bit",0,"Boolified"],bottomToTop:["Bit",1,"Boolified"],leftToRight:["Bit",2,"Boolified"],rightToLeft:["Bit",3,"Boolified"],null0:sizeInt-1,onBeat:["Bool",sizeInt],smooth:["Bool",sizeInt],speed:sizeInt}},{name:"Starfield",code:27,group:"Render",func:"generic",fields:{enabled:sizeInt,color:"Color",output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],WarpSpeed:["Float32",sizeInt],MaxStars_set:sizeInt,onbeat:sizeInt,spdBeat:["Float32",sizeInt],durFrames:sizeInt}},{name:"Text",code:28,group:"Render",func:"generic",fields:{enabled:["Bool",sizeInt],color:["Color",sizeInt],output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],onBeat:["Bool",sizeInt],insertBlanks:["Bool",sizeInt],randomPosition:["Bool",sizeInt],verticalAlign:["Map4",{0:"Top",4:"Center",8:"Bottom"}],horizontalAlign:["Map4",{0:"Left",1:"Center",2:"Right"}],onBeatSpeed:sizeInt,normSpeed:sizeInt,null0:60,null1:4*sizeInt,weight:["Map4",{0:"Dontcare",100:"Thin",200:"Extralight",200:"Ultralight",300:"Light",400:"Normal",400:"Regular",500:"Medium",600:"Semibold",600:"Demibold",700:"Bold",800:"Extrabold",800:"Ultrabold",900:"Heavy",900:"Black"}],italic:["Bool",1],underline:["Bool",1],strikeOut:["Bool",1],charSet:1,null2:4,fontName:["SizeString",32],text:["SizeString",0,"SemiColSplit"],outline:["Bool",sizeInt],outlineColor:"Color",shiftX:sizeInt,shiftY:sizeInt,outlineShadowSize:sizeInt,randomWord:["Bool",sizeInt],shadow:["Bool",sizeInt]}},{name:"Bump",code:29,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],onBeat:["Bool",sizeInt],duration:sizeInt,depth:sizeInt,onBeatDepth:sizeInt,output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],code:"CodeFBI",showDot:["Bool",sizeInt],invertDepth:["Bool",sizeInt],null0:sizeInt,depthBuffer:["BufferNum",sizeInt]}},{name:"Mosaic",code:30,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],size:sizeInt,onBeatSize:sizeInt,output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],onbeat:["Bool",sizeInt],durFrames:sizeInt}},{name:"Water Bump",code:31,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],density:sizeInt,depth:sizeInt,random:["Bool",sizeInt],dropPositionX:sizeInt,dropPositionY:sizeInt,dropRadius:sizeInt,method:sizeInt}},{name:"AVI",code:32,group:"Trans",func:"avi"},{name:"Custom BPM",code:33,group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],mode:["RadioButton",{0:"Arbitrary",1:"Skip",2:"Reverse"}],arbitraryValue:sizeInt,skipValue:sizeInt,skipFirstBeats:sizeInt}},{name:"Picture",code:34,group:"Render",func:"generic",fields:{enabled:["Bool",sizeInt],output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],adapt:sizeInt,onBeatPersist:sizeInt,file:"NtString",ratio:sizeInt,aspectRatioAxis:["Map4",{0:"X",1:"Y"}]}},{name:"Dynamic Distance Modifier",code:35,group:"Trans",func:"generic",fields:{null0:1,code:"CodePFBI",output:["Map4",{0:"Replace",1:"50/50"}],bilinear:["Bool",sizeInt]}},{name:"Super Scope",code:36,group:"Render",func:"generic",fields:{version:["Bool",1],code:"CodePFBI",audioChannel:["Bit",[0,1],"AudioChannel"],audioSource:["Bit",2,"AudioSource"],null0:3,colors:"ColorList",lineType:["DrawMode",sizeInt]}},{name:"Invert",code:37,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt]}},{name:"Unique Tone",code:38,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],color:"Color",output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],invert:["Bool",sizeInt]}},{name:"Timescope",code:39,group:"Render",func:"generic",fields:{enabled:["Bool",sizeInt],color:"Color",output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50",2:"Default"}],audioChannel:["UInt32",sizeInt,"AudioChannel"],bands:sizeInt}},{name:"Set Render Mode",code:40,group:"Misc",func:"generic",fields:{blend:["BlendmodeRender",1],adjustBlend:1,lineSize:1,enabled:["Bit",7,"Boolified"]}},{name:"Interference",code:41,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],numberOfLayers:sizeInt,null0:sizeInt,distance:sizeInt,alpha:sizeInt,rotation:"Int32",output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],onBeatDistance:sizeInt,onBeatAlpha:sizeInt,onBeatRotation:sizeInt,separateRGB:["Bool",sizeInt],onBeat:["Bool",sizeInt],speed:"Float32"}},{name:"Dynamic Shift",code:42,group:"Trans",func:"generic",fields:{version:["Bool",1],code:"CodeIFB",output:["Map4",{0:"Replace",1:"50/50"}],bilinear:["Bool",sizeInt]}},{name:"Dynamic Movement",code:43,group:"Trans",func:"generic",fields:{version:["Bool",1],code:"CodePFBI",bilinear:["Bool",sizeInt],coordinates:["Coordinates",sizeInt],gridW:sizeInt,gridH:sizeInt,alpha:["Bool",sizeInt],wrap:["Bool",sizeInt],buffer:["BufferNum",sizeInt],alphaOnly:["Bool",sizeInt]}},{name:"Fast Brightness",code:44,group:"Trans",func:"generic",fields:{factor:["Map4",{0:2,1:.5,2:1}]}},{name:"Color Modifier",code:45,group:"Trans",func:"generic",fields:{recomputeEveryFrame:["Bool",1],code:"CodePFBI"}}],dllComponents=[{name:"AVS Trans Automation",code:[77,105,115,99,58,32,65,86,83,84,114,97,110,115,32,65,117,116,111,109,97,116,105,111,110,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],logging:["Bool",sizeInt],translateFirstLevel:["Bool",sizeInt],readCommentCodes:["Bool",sizeInt],code:"NtString"}},{name:"Texer",code:[84,101,120,101,114,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{null0:4*sizeInt,image:["SizeString",260],input:["Bit",0,"BlendmodeIn"],output:["Bit",2,"BlendmodeTexer"],null1:3,particles:sizeInt,null2:4}},{name:"Texer II",code:[65,99,107,111,46,110,101,116,58,32,84,101,120,101,114,32,73,73,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Render",func:"generic",fields:{null0:sizeInt,image:["SizeString",260],resizing:["Bool",sizeInt],wrap:["Bool",sizeInt],coloring:["Bool",sizeInt],null1:sizeInt,code:"CodeIFBP"}},{name:"Color Map",code:[67,111,108,111,114,32,77,97,112,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{key:["KeyColorMap",sizeInt],output:["BlendmodeColorMap",sizeInt],mapCycling:["CycleModeColorMap",sizeInt],null0:2,dontSkipFastBeats:["Bool",1],cycleSpeed:1,maps:"ColorMaps"}},{name:"Framerate Limiter",code:[86,70,88,32,70,82,65,77,69,82,65,84,69,32,76,73,77,73,84,69,82,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],limit:sizeInt}},{name:"Convolution Filter",code:[72,111,108,100,101,110,48,51,58,32,67,111,110,118,111,108,117,116,105,111,110,32,70,105,108,116,101,114,0,0,0,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],wrap:["Bool",sizeInt],absolute:["Bool",sizeInt],"2-pass":["Bool",sizeInt],kernel:["ConvoFilter",[7,7]],bias:"Int32",scaling:"Int32"}},{name:"Triangle",code:[82,101,110,100,101,114,58,32,84,114,105,97,110,103,108,101,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{code:"NtCodeIFBP"}},{name:"Channel Shift",code:[67,104,97,110,110,101,108,32,83,104,105,102,116,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{mode:["Map4",{1144:"RGB",1020:"RBG",1019:"BRG",1021:"BGR",1018:"GBR",1022:"GRB"}],onBeatRandom:["Bool",sizeInt]}},{name:"Normalize",code:[84,114,97,110,115,58,32,78,111,114,109,97,108,105,115,101,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt]}},{name:"Video Delay",code:[72,111,108,100,101,110,48,52,58,32,86,105,100,101,111,32,68,101,108,97,121,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],useBeats:["Bool",sizeInt],delay:sizeInt}},{name:"Multiplier",code:[77,117,108,116,105,112,108,105,101,114,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{multiply:["Map4",{0:"Infinite Root",1:8,2:4,3:2,4:.5,5:.25,6:.125,7:"Infinite Square"}]}},{name:"Color Reduction",code:[67,111,108,111,114,32,82,101,100,117,99,116,105,111,110,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{null0:260,colors:["Map4",{1:2,2:4,3:8,4:16,5:32,6:64,7:128,8:256}]}},{name:"Multi Delay",code:[72,111,108,100,101,110,48,53,58,32,77,117,108,116,105,32,68,101,108,97,121,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{mode:["Map4",{0:"Disabled",1:"Input",2:"Output"}],activeBuffer:sizeInt,useBeats0:["Bool",sizeInt],delay0:sizeInt,useBeats1:["Bool",sizeInt],delay1:sizeInt,useBeats2:["Bool",sizeInt],delay2:sizeInt,useBeats3:["Bool",sizeInt],delay3:sizeInt,useBeats4:["Bool",sizeInt],delay4:sizeInt,useBeats5:["Bool",sizeInt],delay5:sizeInt}},{name:"MIDI Trace",code:[78,117,108,108,115,111,102,116,32,80,105,120,101,108,99,111,114,112,115,58,32,77,73,68,73,116,114,97,99,101,32,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],channel:sizeInt,mode:["Map4",{1:"Current",2:"Trigger"}],allChannels:["Bool",sizeInt],printEvents:["Bool",sizeInt]}},{name:"Add Borders",code:[86,105,114,116,117,97,108,32,69,102,102,101,99,116,58,32,65,100,100,98,111,114,100,101,114,115,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],color:"Color",size:sizeInt}},{name:"AVI Player",code:[86,70,88,32,65,86,73,32,80,76,65,89,69,82,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{filePath:["SizeString",256],enabled:["Bool",sizeInt]}},{name:"FyrewurX",code:[70,117,110,107,121,70,88,32,70,121,114,101,119,117,114,88,32,118,49,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt]}},{name:"Global Variables",code:[74,104,101,114,105,107,111,58,32,71,108,111,98,97,108,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{load:["Map4",{0:"None",1:"Once",2:"CodeControl",3:"EveryFrame"}],null0:6*sizeInt,code:"NtCodeIFB",file:"NtString",saveRegRange:"NtString",saveBufRange:"NtString"}},{name:"Fluid",code:[71,101,105,115,115,70,108,117,105,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{null0:sizeInt}},{name:"Picture II",code:[80,105,99,116,117,114,101,32,73,73,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{image:["NtString",260],output:["BlendmodePicture2",sizeInt],onBeatOutput:["BlendmodePicture2",sizeInt],bilinear:["Bool",sizeInt],onBeatBilinear:["Bool",sizeInt],adjustBlend:sizeInt,onBeatAdjustBlend:sizeInt}},{name:"MultiFilter",code:[74,104,101,114,105,107,111,32,58,32,77,85,76,84,73,70,73,76,84,69,82,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],effect:["multiFilterEffect",sizeInt],onBeat:["Bool",sizeInt],null0:["Bool",sizeInt]}}];
function convertPreset(e,t){var n={name:t.name.substr(0,t.name.length-4),date:t.lastModifiedDate.toISOString()},o=new Uint8Array(e);try{var r=decodePresetHeader(o.subarray(0,presetHeaderLength));n.clearFrame=r;var i=convertComponents(o.subarray(presetHeaderLength));n.components=i}catch(a){if(a instanceof ConvertException)return log("Error: "+a.message),null;throw a}return n}function convertComponents(e){for(var t=0,n=[];t<e.length;){var o=getUInt32(e,t),r=getComponentIndex(o,e,t),i=4294967294!==o&&o>builtinMax,a=getComponentSize(e,t+sizeInt+32*i);if(0>r)var u={type:"Unknown: ("+-r+")"};else var g=t+2*sizeInt+32*i,u=window["decode_"+componentTable[r].func](e,g,componentTable[r].fields,componentTable[r].name,g+a);if(!u||"object"!=typeof u)throw new ConvertException("Unknown convert error");n.push(u),t+=a+2*sizeInt+32*i}return n}function getComponentIndex(e,t,n){if(builtinMax>e||4294967294===e){for(var o=0;o<componentTable.length;o++)if(e===componentTable[o].code)return log("Found component: "+componentTable[o].name+" ("+e+")"),o}else for(var o=builtinComponents.length;o<componentTable.length;o++)if(componentTable[o].code instanceof Array&&cmpBytes(t,n+sizeInt,componentTable[o].code))return log("Found component: "+componentTable[o].name),o;return log("Found unknown component (code: "+e+")"),-e}function getComponentSize(e,t){return getUInt32(e,t)}function decodePresetHeader(e){var t=[78,117,108,108,115,111,102,116,32,65,86,83,32,80,114,101,115,101,116,32,48,46,49,26],n=[78,117,108,108,115,111,102,116,32,65,86,83,32,80,114,101,115,101,116,32,48,46,50,26];if(!cmpBytes(e,0,n)&&!cmpBytes(e,0,t))throw new ConvertException("Invalid preset header.");return 1===e[presetHeaderLength-1]}function decode_effectList(e,t){var n=getUInt32(e,t-sizeInt),o={type:"EffectList",enabled:1!==getBit(e,t,1)[0],clearFrame:1===getBit(e,t,0)[0],input:getBlendmodeIn(e,t+2,1)[0],output:getBlendmodeOut(e,t+3,1)[0],inAdjustBlend:getUInt32(e,t+5),outAdjustBlend:getUInt32(e,t+9),inBuffer:getUInt32(e,t+13),outBuffer:getUInt32(e,t+17),inBufferInvert:1===getUInt32(e,t+21),outBufferInvert:1===getUInt32(e,t+25),enableOnBeat:1===getUInt32(e,t+29),onBeatFrames:getUInt32(e,t+33)},r=[0,64,0,0,65,86,83,32,50,46,56,43,32,69,102,102,101,99,116,32,76,105,115,116,32,67,111,110,102,105,103,0,0,0,0,0],i=t+37,a=n-37,u=i;if(cmpBytes(e,i,r)){i+=r.length;var g=getUInt32(e,i);u+=r.length+sizeInt+g,a=n-37-r.length-sizeInt-g,o.codeEnabled=1===getUInt32(e,i+sizeInt);var s=getUInt32(e,i+2*sizeInt);o.init=getSizeString(e,i+2*sizeInt)[0],o.frame=getSizeString(e,i+3*sizeInt+s)[0]}var c=convertComponents(e.subarray(u,u+a));return o.components=c,o}function decode_generic(e,t,n,o,r){for(var i={type:removeSpaces(o)},a=Object.keys(n),u=!1,g=0;g<a.length&&!(t>=r);g++){var s=a[g],c=n[s];if(s.match(/^null[_0-9]*$/))t+=c,u=!1;else{var d,l,f=0,p="number"==typeof c,I="string"==typeof c;if(p){switch(c){case 1:f=1,d=e[t];break;case sizeInt:f=sizeInt,d=getUInt32(e,t);break;default:throw new ConvertException("Invalid field size: "+c+".")}u=!1}else if(I){try{l=window["get"+c](e,t)}catch(m){throw m.message.search(/has no method'/)>=0?new ConvertException("Method '"+c+"' was not found. (correct capitalization?)"):m}d=l[0],f=l[1],u=!1}else if(c&&c.length>=2){"Bit"===c[0]?(u&&(t-=1),u=!0):u=!1;try{l=window["get"+c[0]](e,t,c[1]),d=l[0],c[2]&&(d=window["get"+c[2]](d))}catch(m){throw m.message.search(/has no method/)>=0?new ConvertException("Method '"+c+"' was not found. (correct capitalization?)"):m}f=l[1]}i[s]=d,verbose&&log("k: "+s+", val: "+d+", offset: "+t),t+=f}}return i}function decode_movement(e,t){var n,o={type:"Movement"},r=getUInt32(e,t),i=[];if(0!==r)if(32767===r){var a=getSizeString(e,t+sizeInt+1);t+=a[1],n=a[0]}else i=movementEffects[r];else{var u=getUInt32(e,t+6*sizeInt);i=movementEffects[u]}return i.length&&(o.builtinEffect=i[0]),o.output=getUInt32(e,t+sizeInt)?"50/50":"Replace",o.sourceMapped=getBool(e,t+2*sizeInt,sizeInt)[0],o.coordinates=getCoordinates(e,t+3*sizeInt,sizeInt),o.bilinear=getBool(e,t+4*sizeInt,sizeInt)[0],o.wrap=getBool(e,t+5*sizeInt,sizeInt)[0],i.length&&1!==r&&7!==r&&(n=i[1],o.coordinates=i[2]),o.code=n,o}function decode_avi(e,t){var n={type:"AVI",enabled:getBool(e,t,sizeInt)[0]},o=getNtString(e,t+3*sizeInt);n.file=o[0],n.speed=getUInt32(e,t+5*sizeInt+o[1]);var r=getUInt32(e,t+3*sizeInt+o[1]);return n.output=r?"50/50":getMap8(e,t+sizeInt,{0:"Replace",1:"Additive",4294967296:"50/50"}),n.onBeatAdd=r,n.persist=getUInt32(e,t+4*sizeInt+o[1]),n}function decode_simple(e,t){var n={type:"Simple"},o=getUInt32(e,t);if(64&o)n.audioSource=2&o?"Waveform":"Spectrum",n.renderType="Dots";else switch(3&o){case 0:n.audioSource="Spectrum",n.renderType="Solid";break;case 1:n.audioSource="Spectrum",n.renderType="Lines";break;case 2:n.audioSource="Waveform",n.renderType="Lines";break;case 3:n.audioSource="Waveform",n.renderType="Solid"}return n.audioChannel=getAudioChannel(o>>2&3),n.positionY=getPositionY(o>>4&3),n.colors=getColorList(e,t+sizeInt)[0],n}function getMap1(e,t,n){return[getMapping(n,e[t]),1]}function getMap4(e,t,n){return[getMapping(n,getUInt32(e,t)),sizeInt]}function getMap8(e,t,n){return[getMapping(n,getUInt64(e,t)),2*sizeInt]}function getRadioButton(e,t,n){for(var o=0,r=0;r<n.length;r++){var i=0!==getUInt32(e,t+sizeInt*r);i&&(o=i*(r+1))}return[getMapping(n,o),sizeInt*n.length]}function getMapping(e,t){var n=e[t];if(void 0===n)throw new ConvertException("Map: A value for key '"+t+"' does not exist.");return n}function getCodePFBI(e,t){var n=[["init",3],["perFrame",1],["onBeat",2],["perPoint",0]];return getCodeSection(e,t,n)}function getCodeFBI(e,t){var n=[["init",2],["perFrame",1],["onBeat",0]];return getCodeSection(e,t,n)}function getCodeIFBP(e,t){var n=[["init",0],["perFrame",1],["onBeat",2],["perPoint",3]];return getCodeSection(e,t,n)}function getCodeIFB(e,t){var n=[["init",0],["perFrame",1],["onBeat",2]];return getCodeSection(e,t,n)}function getNtCodeIFB(e,t){var n=[["init",0],["perFrame",1],["onBeat",2]];return getCodeSection(e,t,n,!0)}function getNtCodeIFBP(e,t){var n=[["init",0],["perFrame",1],["onBeat",2],["perPoint",3]];return getCodeSection(e,t,n,!0)}function getCodeSection(e,t,n,o){for(var r=new Array(n.length),i=0,a=0,u=t;a<n.length;a++,u+=g[1]){var g=o?getNtString(e,u):getSizeString(e,u);i+=g[1],r[a]=g[0]}for(var s={},a=0;a<r.length;a++)s[n[a][0]]=r[n[a][1]];return[s,i]}function getColorList(e,t){for(var n=[],o=getUInt32(e,t),r=sizeInt+o*sizeInt;o>0;)t+=sizeInt,n.push(getColor(e,t)[0]),o--;return[n,r]}function getColorMaps(e,t){for(var n=t+480,o=[],r=60,i=0,a=0;8>a;a++){var u=getBool(e,t+r*a,sizeInt)[0],g=getUInt32(e,t+r*a+sizeInt),s=getColorMap(e,n,g);if(u||2!==s.length||"#000000"!==s[0].color||0!==s[0].position||"#ffffff"!==s[1].color||255!==s[1].position){if(o[i]={index:a,enabled:u},allFields){var c=getUInt32(e,t+r*a+2*sizeInt),d=getNtString(e,t+r*a+3*sizeInt)[0];o[i].id=c,o[i].fileName=d}o[i].map=s,i++}else;n+=g*sizeInt*3}return[o,n-t]}function getColorMap(e,t,n){for(var o=[],r=0;n>r;r++){var i=getUInt32(e,t),a=getColor(e,t+sizeInt)[0];t+=3*sizeInt,o[r]={color:a,position:i}}return o}function getColor(e,t){for(var n=getUInt32(e,t).toString(16),o="",r=n.length;6>r;r++)o+="0";return["#"+o+n,sizeInt]}function getConvoFilter(e,t,n){if(!(n instanceof Array)&&2!==n.length)throw new ConvertException("ConvoFilter: Size must be array with x and y dimensions in dwords.");for(var o=n[0]*n[1],r=new Array(o),i=0;o>i;i++,t+=sizeInt)r[i]=getInt32(e,t)[0];var a={width:n[0],height:n[1],data:r};return[a,o*sizeInt]}function getSemiColSplit(e){var t=e.split(";");return 1===t.length?t[0]:t}function getBlendmodeIn(e,t,n){var o=1===n?e[t]:getUInt32(e,t);return[blendmodesIn[o],n]}function getBlendmodeOut(e,t,n){var o=1===n?e[t]:getUInt32(e,t);return[blendmodesOut[o],n]}function getBlendmodeBuffer(e,t,n){var o=1===n?e[t]:getUInt32(e,t);return[blendmodesBuffer[o],n]}function getBlendmodeRender(e,t,n){var o=1===n?e[t]:getUInt32(e,t);return[blendmodesRender[o],n]}function getBlendmodePicture2(e,t,n){var o=1===n?e[t]:getUInt32(e,t);return[blendmodesPicture2[o],n]}function getBlendmodeColorMap(e,t,n){var o=1===n?e[t]:getUInt32(e,t);return[blendmodesColorMap[o],n]}function getBlendmodeTexer(e,t,n){var o=1===n?e[t]:getUInt32(e,t);return[blendmodesTexer[o],n]}function getKeyColorMap(e,t,n){var o=1===n?e[t]:getUInt32(e,t);return[keysColorMap[o],n]}function getCycleModeColorMap(e,t,n){var o=1===n?e[t]:getUInt32(e,t);return[cycleModesColorMap[o],n]}function getBufferMode(e,t,n){var o=1===n?e[t]:getUInt32(e,t);return[buffermodes[o],n]}function getBufferNum(e,t,n){var o=1===n?e[t]:getUInt32(e,t);return 0===o?["Current",n]:[getUInt32(e,t),n]}function getCoordinates(e,t,n){var o=1===n?e[t]:getUInt32(e,t);return[coordinates[o],n]}function getDrawMode(e,t,n){var o=1===n?e[t]:getUInt32(e,t);return[drawModes[o],n]}function getAudioChannel(e){return audioChannels[e]}function getAudioSource(e){return audioSources[e]}function getPositionX(e){return positionsX[e]}function getPositionY(e){return positionsY[e]}function getMultiFilterEffect(e){return multiFilterEffect[e]}var componentTable=builtinComponents.concat(dllComponents);
function checkCompat(){compat=window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1}function loadDir(e,r){for(var n=e.files,i=[],o=0;o<n.length;o++)r.test(n[o].name)&&i.push(n[o]);return i}function loadFile(e,r){if(!e instanceof File)return log("Error: 'file' parameter is no file."),!1;if("function"!=typeof r)return log("Error: 'callback' parameter is no function."),!1;log("Loading file "+e.name+"... ");var n=new FileReader;n.onloadend=function(n){n.target.readyState==FileReader.DONE&&r(n.target.result,e)},n.readAsArrayBuffer(e)}
function saveAvsAsJson(t,o){var n=convertPreset(t,o),e="#output";$(e).html(JSON.stringify(n,null,prettyPrint?"    ":null)),$(e).each(function(t,o){hljs.highlightBlock(o)}),console.log("loaded:\n"+atob(n))}function jsonPrintSpecials(t,o){return"convolutionMatrix"===t?o.join(","):o}var compat=!1,outputDir="",pedanticMode=!1,verbose=!0,allFields=!0,prettyPrint=!0;$(document).ready(function(){checkCompat(),log("File API check: "+(compat?"success":"fail")+".");var t=[];$("#preset").change(function(){t=loadDir(this,/\.avs$/),log("Found "+t.length+" files in directory.");for(var o=0;o<t.length;o++)loadFile(t[o],saveAvsAsJson)})});
var blendmodesIn={0:"Ignore",1:"Replace",2:"50/50",3:"Maximum",4:"Additive",5:"Dest-Src",6:"Src-Dest",7:"EveryOtherLine",8:"EveryOtherPixel",9:"XOR",10:"Adjustable",11:"Multiply",12:"Buffer"},blendmodesOut={0:"Replace",1:"Ignore",2:"Maximum",3:"50/50",4:"Dest-Src",5:"Additive",6:"EveryOtherLine",7:"Src-Dest",8:"XOR",9:"EveryOtherPixel",10:"Multiply",11:"Adjustable",13:"Buffer"},blendmodesBuffer={0:"Replace",1:"50/50",2:"Additive",5:"EveryOtherPixel",4:"Dest-Src",5:"EveryOtherLine",6:"XOR",7:"Maximum",8:"Minimum",9:"Src-Dest",10:"Multiply",11:"Adjustable"},blendmodesRender={0:"Replace",1:"Additive",2:"Maximum",3:"50/50",4:"Dest-Src",5:"Src-Dest",6:"Multiply",7:"Adjustable",8:"XOR"},blendmodesPicture2={0:"Replace",1:"Additive",2:"Maximum",3:"Minimum",4:"50/50",5:"Dest-Src",6:"Src-Dest",7:"Multiply",8:"XOR",9:"Adjustable",10:"Ignore"},blendmodesColorMap={0:"Replace",1:"Additive",2:"Maximum",3:"50/50",4:"Dest-Src",5:"Src-Dest",6:"Multiply",7:"Adjustable",8:"XOR"},blendmodesTexer={0:"Texture",1:"Masked Texture"},keysColorMap={0:"Red",1:"Green",2:"Blue",3:"(R+G+B)/2",4:"MaxChannel",5:"(R+G+B)/3"},cycleModesColorMap={0:"None (Map 1)",1:"OnBeat Random",2:"OnBeat Sequential"},buffermodes={0:"Save",1:"Restore",2:"AlternateSaveRestore",3:"AlternateRestoreSave"},coordinates={0:"Polar",1:"Cartesian"},drawModes={0:"Dots",1:"Lines"},audioChannels={0:"Left",1:"Right",2:"Center"},audioSources={0:"Waveform",1:"Spectrum"},positionsX={0:"Left",1:"Right",2:"Center"},positionsY={0:"Top",1:"Bottom",2:"Center"},multiFilterEffect={0:"Chrome",1:"Double Chrome",2:"Triple Chrome",3:"Infinite Root Multiplier + Small Border Convolution"},movementEffects={0:["None","",0],1:["Slight Fuzzify","",0],2:["Shift Rotate Left","x=x+1/32; // use wrap for this one",1],3:["Big Swirl Out","r = r + (0.1 - (0.2 * d));\r\nd = d * 0.96;",0],4:["Medium Swirl","d = d * (0.99 * (1.0 - sin(r-$PI*0.5) / 32.0));\r\nr = r + (0.03 * sin(d * $PI * 4));",0],5:["Sunburster","d = d * (0.94 + (cos((r-$PI*0.5) * 32.0) * 0.06));",0],6:["Swirl To Center","d = d * (1.01 + (cos((r-$PI*0.5) * 4) * 0.04));\r\nr = r + (0.03 * sin(d * $PI * 4));",0],7:["Blocky Partial Out","",0],8:["Swirling Around Both Ways At Once","r = r + (0.1 * sin(d * $PI * 5));",0],9:["Bubbling Outward","t = sin(d * $PI);\r\nd = d - (8*t*t*t*t*t)/sqrt((sw*sw+sh*sh)/4);",0],10:["Bubbling Outward With Swirl","t = sin(d * $PI);\r\nd = d - (8*t*t*t*t*t)/sqrt((sw*sw+sh*sh)/4);\r\nt=cos(d*$PI/2.0);\r\nr= r + 0.1*t*t*t;",0],11:["5 Pointed Distro","d = d * (0.95 + (cos(((r-$PI*0.5) * 5.0) - ($PI / 2.50)) * 0.03));",0],12:["Tunneling","r = r + 0.04;\r\nd = d * (0.96 + cos(d * $PI) * 0.05);",0],13:["Bleedin'","t = cos(d * $PI);\r\nr = r + (0.07 * t);\r\nd = d * (0.98 + t * 0.10);",0],14:["Shifted Big Swirl Out","d=sqrt(x*x+y*y); r=atan2(y,x);\r\nr=r+0.1-0.2*d; d=d*0.96;\r\nx=cos(r)*d + 8/128; y=sin(r)*d;",0,1],15:["Psychotic Beaming Outward","d = 0.15",0],16:["Cosine Radial 3-way","r = cos(r * 3)",0],17:["Spinny Tube","d = d * (1 - ((d - .35) * .5));\r\nr = r + .1;",0],18:["Radial Swirlies","d = d * (1 - (sin((r-$PI*0.5) * 7) * .03));\r\nr = r + (cos(d * 12) * .03);",0],19:["Swill","d = d * (1 - (sin((r - $PI*0.5) * 12) * .05));\r\nr = r + (cos(d * 18) * .05);\r\nd = d * (1-((d - .4) * .03));\r\nr = r + ((d - .4) * .13)",0],20:["Gridley","x = x + (cos(y * 18) * .02);\r\ny = y + (sin(x * 14) * .03);",1],21:["Grapevine","x = x + (cos(abs(y-.5) * 8) * .02);\r\ny = y + (sin(abs(x-.5) * 8) * .05);\r\nx = x * .95;\r\ny = y * .95;",1],22:["Quadrant","y = y * ( 1 + (sin(r + $PI/2) * .3) );\r\nx = x * ( 1 + (cos(r + $PI/2) * .3) );\r\nx = x * .995;\r\ny = y * .995;",1],23:["6-way Kaleida (use Wrap!)","y = (r*6)/($PI); x = d;",1]};
function SelectText(e){var t=document,n=t.getElementById(e);if(t.body.createTextRange){var o=t.body.createTextRange();o.moveToElementText(n),o.select()}else if(window.getSelection){var c=window.getSelection(),o=t.createRange();o.selectNodeContents(n),c.removeAllRanges(),c.addRange(o)}}hljs.initHighlightingOnLoad(),$(function(){$("#output").click(function(){SelectText("output")})});
function log(t){$("#log").prepend(t+"\n")}function ConvertException(t){this.message=t,this.name="ConvertException"}function cmpBytes(t,e,n){for(var r=0;r<n.length;r++)if(null!==n[r]&&t[r+e]!==n[r])return!1;return!0}function getBit(t,e,n){if(n instanceof Array){2!==n.length&&new ConvertException("Wrong Bitfield range");var r=(2<<n[1]-n[0])-1;return[t[e]>>n[0]&r,1]}return[t[e]>>n&1,1]}function getUInt32(t,e){e||(e=0);var n=t.buffer.slice(t.byteOffset+e,t.byteOffset+e+sizeInt);return new Uint32Array(n,0,1)[0]}function getInt32(t,e){e||(e=0);var n=t.buffer.slice(t.byteOffset+e,t.byteOffset+e+sizeInt);return[new Int32Array(n,0,1)[0],4]}function getUInt64(t,e){e||(e=0);var n=t.buffer.slice(t.byteOffset+e,t.byteOffset+e+2*sizeInt),r=new Uint32Array(n,0,2);return r[0]+4294967296*r[1]}function getFloat32(t,e){e||(e=0);var n=t.buffer.slice(t.byteOffset+e,t.byteOffset+e+sizeInt);return[new Float32Array(n,0,1)[0],4]}function getBool(t,e,n){var r=1===n?t[e]:getUInt32(t,e);return[0!==r,n]}function getBoolified(t){return 0==t?!1:!0}function getSizeString(t,e,n){var r=0,f="";n||(n=getUInt32(t,e),r=sizeInt);for(var i=e+n+r,o=e+r,u=t[o];u>0&&i>o;)f+=String.fromCharCode(u),u=t[++o];return[f,n+r]}function getNtString(t,e){for(var n="",r=e,f=t[r];f>0;)n+=String.fromCharCode(f),f=t[++r];return[n,r-e+1]}function removeSpaces(t){return t.replace(/[ ]/g,"")}var sizeInt=4,presetHeaderLength=25,builtinMax=16384;